var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),EffectWindow=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){var e=330,t=this;t.box&&egret.Tween.get(t.box).set({scaleX:.5,scaleY:.5,x:t.box.x+t.box.width/4,y:t.box.y+t.box.height/4}).to({scaleX:1,scaleY:1,x:t.box.x-t.box.width/4,y:t.box.y-t.box.height/4},e,egret.Ease.backOut),egret.Tween.get(t).set({alpha:0}).to({alpha:1},e)},t.prototype.dispose=function(){var e=280,t=this;TweenUtils.showBackIn(t.box,e,function(){t.parent&&t.parent.removeChild(t),egret.Tween.removeTweens(t)},t),egret.Tween.get(t).to({alpha:0},e)},t}(eui.Component);__reflect(EffectWindow.prototype,"EffectWindow");var DoLack=function(e){function t(t){var n=e.call(this)||this;return n.skinName=DoLackSkin,n.lack=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.horizontalCenter=0,this.bottom=150;var t,n,r,i;this.btn_tong.addEventListener(egret.TouchEvent.TOUCH_TAP,n=function(){e.sendMsg(1)},this),this.btn_tiao.addEventListener(egret.TouchEvent.TOUCH_TAP,r=function(){e.sendMsg(2)},this),this.btn_wan.addEventListener(egret.TouchEvent.TOUCH_TAP,i=function(){e.sendMsg(3)},this),EventMgr.ins.addEventListener(""+NET_CMD.DO_LACK,t=function(){e.parent.removeChild(e)},this),this.showRecommend(),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.btn_tong.removeEventListener(egret.TouchEvent.TOUCH_TAP,n,e),e.btn_tiao.removeEventListener(egret.TouchEvent.TOUCH_TAP,r,e),e.btn_wan.removeEventListener(egret.TouchEvent.TOUCH_TAP,i,e),EventMgr.ins.removeEventListener(""+NET_CMD.DO_LACK,t,e),egret.clearInterval(e.lightInterval)},this)},t.prototype.sendMsg=function(e){EventMgr.ins.sendMessage({cmd:NET_CMD.DO_LACK,lack:e}),this.parent.removeChild(this)},t.prototype.showRecommend=function(){var e;switch(this.lack){case 1:e=this.btn_tong;break;case 2:e=this.btn_tiao;break;case 3:e=this.btn_wan}var t=new eui.Image("lack_recommend_png");e.addChild(t),t.horizontalCenter=0,t.top=-50;var n=function(){egret.Tween.get(t).set({alpha:0}).to({alpha:1},700).to({alpha:0},700)};n(),this.lightInterval=egret.setInterval(function(){n()},this,1500)},t}(eui.Component);__reflect(DoLack.prototype,"DoLack");var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isThemeLoadEnd=!1,t.isResourceLoadEnd=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),-1==window.location.href.indexOf("192.168.3.222")&&(console.log("jinrufangfa"),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){SoundMgr.closeBgMuisc(),egret.ticker.pause()},egret.lifecycle.onResume=function(){SoundMgr.playBgMuisc(),egret.ticker.resume()}),RES.web.Html5VersionController.prototype.getVirtualUrl=function(e){return e+="?v="+window.resVersion};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(window.ossServer+"resource/default.res.json",window.ossServer+"resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme(window.ossServer+"resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.setMaxLoadingThread(20),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},t.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.startCreateScene=function(){StageMgr.ins.initStage(this),StageMgr.ins.loadBase(new Login)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(r))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DragonMgr=function(){function e(){}return Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.playDragon=function(e,t,n,r,i,a){void 0===i&&(i={});try{var s=dragonBones.EgretFactory.factory;if(!s.getDragonBonesData(t)||!s.getTextureAtlasData(t)){var o=RES.getRes(t+"_ske_json"),c=RES.getRes(t+"_tex_json"),d=RES.getRes(t+"_tex_png");s.parseDragonBonesData(o),s.parseTextureAtlasData(c,d)}var h=s.buildArmatureDisplay(n,t);h.x=i.dx||0,h.y=i.dy||0,h.name=i.name||"",e.addChild(h),h.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){!i.noRemove&&h.parent&&h.parent.removeChild(h),h.dispose(),a&&a()},this),h.animation.timeScale=i.timeScale||1,h.animation.play(r,i.playTimes||0)}catch(l){console.log("动画播放失败 -- "+l)}},e}();__reflect(DragonMgr.prototype,"DragonMgr");var EventMgr=function(e){function t(){var t=e.call(this)||this;return t.errorMsg={},t}return __extends(t,e),Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.onNetMsg=function(e){if(e.errorCode)try{StageMgr.ins.addTips(new Tips(this.errorMsg[e.cmd][e.errorCode]),1)}catch(n){egret.error("未处理错误码 -- "+e.cmd+":"+e.errorCode)}else-1!=Object.keys(NET_CMD).indexOf(""+e.cmd)?t.ins.dispatchEvent(new egret.Event(""+e.cmd,!1,!1,e)):console.log("未处理消息 -- "+e.cmd)},t.prototype.onEvt=function(e,n){-1!=Object.keys(SELF_EVT).indexOf(""+e)&&t.ins.dispatchEvent(new egret.Event(""+e,!1,!1,n))},t.prototype.sendMessage=function(e){IframeManager.ins.sendMessage(JSON.stringify(e))},t}(egret.EventDispatcher);__reflect(EventMgr.prototype,"EventMgr");var NET_CMD;!function(e){e[e.GET_ROOM_INFO=250003]="GET_ROOM_INFO",e[e.READY=250005]="READY",e[e.LEAVE_GAME=250006]="LEAVE_GAME",e[e.DEAL_CARD=250007]="DEAL_CARD",e[e.CHANGE_3=250015]="CHANGE_3",e[e.DO_LACK=250016]="DO_LACK",e[e.TIPS_LACK=250017]="TIPS_LACK",e[e.PUT_CARD=250020]="PUT_CARD",e[e.TOUCH_CARD=250021]="TOUCH_CARD",e[e.PENG_GANG_SHOW=250025]="PENG_GANG_SHOW",e[e.PENG_GANG=250026]="PENG_GANG",e[e.HIDE_CHI_PENG_GANG=250027]="HIDE_CHI_PENG_GANG",e[e.SETTLEMENT_SMALL=250030]="SETTLEMENT_SMALL",e[e.SETTLEMENT_TOTAL=250031]="SETTLEMENT_TOTAL",e[e.DISSOLVE_GAME=250032]="DISSOLVE_GAME",e[e.UPDATE_SCORE=250033]="UPDATE_SCORE",e[e.CHAT_MSG=250035]="CHAT_MSG",e[e.PLAYER_DISCONNECT=250036]="PLAYER_DISCONNECT"}(NET_CMD||(NET_CMD={}));var SELF_EVT;!function(e){e[e.READY=0]="READY",e[e.CONNECT_SUCCESS=1]="CONNECT_SUCCESS",e[e.CLICK_MENU=2]="CLICK_MENU",e[e.UPDATE_TIME=3]="UPDATE_TIME",e[e.CLICK_PGH=4]="CLICK_PGH",e[e.STOP_VOICE=5]="STOP_VOICE",e[e.SHARE_FINISH=6]="SHARE_FINISH",e[e.UPDATE_SCORE=7]="UPDATE_SCORE",e[e.UPDATE_LACK=8]="UPDATE_LACK",e[e.VOICE_STATUS_UPDATE=9]="VOICE_STATUS_UPDATE",e[e.OPTION_SEATNO=10]="OPTION_SEATNO",e[e.UPDATE_BANKER=11]="UPDATE_BANKER",e[e.SELECTED_CARD=12]="SELECTED_CARD",e[e.CAN_HU_CARD=13]="CAN_HU_CARD"}(SELF_EVT||(SELF_EVT={}));var HuCardTipsMgr=function(e){function t(){var t=e.call(this)||this;return t.curAppeared={},t}return __extends(t,e),Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.start=function(){var e=this;EventMgr.ins.addEventListener(""+NET_CMD.DEAL_CARD,function(t){e.init(),t.data.cardsList.forEach(function(t){e.addOneCard(t)},e),e.meHandCard=t.data.cardsList},this),EventMgr.ins.addEventListener(""+NET_CMD.TOUCH_CARD,function(t){1==PlayerMgr.ins.getLocalSeatNo(t.data.touchSeat)&&(e.addOneCard(t.data.touchCard),e.meHandCard.push(t.data.touchCard))},this),EventMgr.ins.addEventListener(""+NET_CMD.PUT_CARD,function(t){1!=PlayerMgr.ins.getLocalSeatNo(t.data.putSeatId)?e.addOneCard(t.data.putCard):e.meHandCard.splice(e.meHandCard.indexOf(t.data.putCard),1)},this),EventMgr.ins.addEventListener(""+NET_CMD.CHANGE_3,function(t){var n,r=t.data.changeType;switch(r){case 1:n=PlayerMgr.ins.seatNo-1>0?PlayerMgr.ins.seatNo-1:4;break;case 2:n=PlayerMgr.ins.seatNo+1<=4?PlayerMgr.ins.seatNo+1:1;break;case 3:n=PlayerMgr.ins.seatNo+2<=4?PlayerMgr.ins.seatNo+2:(PlayerMgr.ins.seatNo+2)%4}t.data.exchangeAfter[n].forEach(function(t){e.deleteOneCard(t),e.meHandCard.splice(e.meHandCard.indexOf(t),1)}),t.data.exchangeAfter[PlayerMgr.ins.seatNo].forEach(function(t){e.addOneCard(t),e.meHandCard.push(t)})},this),EventMgr.ins.addEventListener(""+NET_CMD.PENG_GANG,function(t){if(!t.data.huCard){var n=t.data.data.card,r=PlayerMgr.ins.getLocalSeatNo(t.data.seatId),i=void 0;switch(t.data.data.type){case 1:i=2;break;case 2:i=1;break;case 3:i=4;break;case 4:i=3}for(var a=0;i>a;a++)1!=r?e.addOneCard(n):e.meHandCard.splice(e.meHandCard.indexOf(n),1)}},this),EventMgr.ins.addEventListener(""+SELF_EVT.SELECTED_CARD,function(t){var n=t.data;if(PlayerMgr.ins.isLack&&n&&1==PlayerMgr.ins.curThinkPlayerLocalSeat){for(var r=[],i=e.meHandCard.indexOf(n),a=e.meHandCard.filter(function(e,t){return t!=i}),s=0;3>s;s++)for(var o=20*s+1;20*s+10>o;o++){var c=a.concat(o).sort(Utils.sortCard);e.checkSeven(c)?r.push(o):e.checkCanHu(c)&&r.push(o)}e.onSelectedCanHu(r)}},this),PlayerMgr.ins.currentGameStatus>2&&7!=PlayerMgr.ins.currentGameStatus&&this.onReset()},t.prototype.init=function(){this.curAppeared={},this.meHandCard=[]},t.prototype.addOneCard=function(e){var t=this.curAppeared;t[""+e]?t[""+e]++:t[""+e]=1},t.prototype.deleteOneCard=function(e){var t=this.curAppeared;t[""+e]--},t.prototype.checkSeven=function(e){if(14!=e.length)return!1;for(var t=0;14>t;t+=2)if(e[t]!=e[t+1])return!1;return!0},t.prototype.checkCanHu=function(e,t){if(void 0===t&&(t=!1),!e.length)return t;if(2==e.length)return e[0]==e[1]&&!t;var n=e[0];if(n==e[1]&&!t&&this.checkCanHu(e.slice(2),!0))return!0;if(n==e[2])return this.checkCanHu(e.slice(3),t);var r=[e.indexOf(n+1),e.indexOf(n+2)],i=r[0],a=r[1];return-1==i||-1==a?!1:this.checkCanHu(e.filter(function(e,t){return 0!=t&&t!=i&&t!=a}),t)},t.prototype.onSelectedCanHu=function(e){var t=this;e.length&&EventMgr.ins.onEvt(SELF_EVT.CAN_HU_CARD,e.map(function(e){return{card:e,num:4-(t.curAppeared[e]||0)}},this))},t.prototype.onReset=function(){var e=this;this.init();var t=PlayerMgr.ins.userArr;Object.keys(t).forEach(function(n){var r=t[n],i=PlayerMgr.ins.getLocalSeatNo(r.seatId);r.handCards&&1==i&&(r.handCards.forEach(function(t){e.addOneCard(t)},e),e.meHandCard=r.handCards),r.pGDate&&r.pGDate.forEach(function(t){var n;switch(t.type){case 1:n=3;break;case 2:case 3:case 4:n=4}for(var r=0;n>r;r++)e.addOneCard(t.card)},e),r.putCards&&r.putCards.forEach(function(t){e.addOneCard(t)},e)},this)},t}(egret.EventDispatcher);__reflect(HuCardTipsMgr.prototype,"HuCardTipsMgr");var IframeManager=function(e){function t(){var t=e.call(this)||this;return window.addEventListener("message",t.onReceiveMsg,!1),t}return __extends(t,e),Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.onReceiveMsg=function(e){var n=e.data;if(e.data.forLobby)switch(e.data.cmd){case"ready":EventMgr.ins.onEvt(SELF_EVT.READY);break;case"offline":StageMgr.ins.addTips(new Tips("您已经掉线，请刷新重试"),1,function(){t.ins.freshFrame()});break;case"shareSuccess":case"shareFail":case"shareCancel":EventMgr.ins.onEvt(SELF_EVT.SHARE_FINISH);break;case"startRecordSuccess":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:1});break;case"startRecordFail":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:-1});break;case"stopRecordSuccess":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:2});break;case"stopRecordFail":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:-2});break;case"uploadVoiceSuccess":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:3,data:e.data.serverId});break;case"uploadVoiceFail":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:-3});break;case"downloadVoiceSuccess":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:4});break;case"downloadVoiceFail":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:-4});break;case"playVoiceSuccess":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:5});break;case"playVoiceFail":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:-5});break;case"stopVoiceSuccess":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:6});break;case"stopVoiceFail":EventMgr.ins.onEvt(SELF_EVT.VOICE_STATUS_UPDATE,{status:-6})}else EventMgr.ins.onNetMsg(n)},t.prototype.sendMessage=function(e){window.parent.postMessage(e,"*")},t.prototype.getDataFromIframe=function(){this.sendMessage({forLobby:!0,cmd:"room"})},t.prototype.backToHall=function(){this.sendMessage({forLobby:!0,cmd:"close"})},t.prototype.sendUILoadFinish=function(){this.sendMessage({forLobby:!0,cmd:"ready"})},t.prototype.freshFrame=function(){this.sendMessage({forLobby:!0,cmd:"refresh"})},t.prototype.startRecord=function(){this.sendMessage({forLobby:!0,cmd:"wx",func:"startRecord"})},t.prototype.stopRecord=function(e){void 0===e&&(e=0),this.sendMessage({forLobby:!0,cmd:"wx",func:"stopRecord",type:e})},t.prototype.downloadRecord=function(e){this.sendMessage({forLobby:!0,cmd:"wx",func:"downloadVoice",serverId:e})},t.prototype.playRecord=function(e){this.sendMessage({forLobby:!0,cmd:"wx",func:"playVoice",serverId:e})},t.prototype.initWxShare=function(e,t,n){this.sendMessage({forLobby:!0,cmd:"wx",func:"initShare",title:e,desc:t,imgUrl:n})},t}(egret.EventDispatcher);__reflect(IframeManager.prototype,"IframeManager");var PlayerMgr=function(){function e(){this.userArr={},this.putTimeOut=20}return Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.getLocalSeatNo=function(t){var n=t-e.ins.seatNo+1;return 0>=n&&(n+=4),n},e.prototype.getPlayerForSeatNo=function(t){var n=e.ins.userArr,r=null;return Object.keys(n).forEach(function(e){return n[e].seatId==t?void(r=n[e]):void 0},this),r||-1},e}();__reflect(PlayerMgr.prototype,"PlayerMgr");var SocketMgr=function(){function e(){this.host="192.168.3.117",this.port=9001}return Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.connect=function(){this.socket=new egret.WebSocket,this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CLOSE,this.onServerClose,this),this.socket.connect(this.host,this.port)},e.prototype.onSocketOpen=function(e){EventMgr.ins.onEvt(SELF_EVT.CONNECT_SUCCESS)},e.prototype.onServerClose=function(e){StageMgr.ins.addTips(new Tips("网络连接中断，请检查网络"),1,function(){window.location.href=window.location.href})},e.prototype.onReceiveMessage=function(e){var t,n;try{t=this.socket.readUTF(),n=JSON.parse(t)}catch(r){console.error("解析数据异常"),console.log(t)}EventMgr.ins.onNetMsg(n)},e}();__reflect(SocketMgr.prototype,"SocketMgr");var SoundMgr;!function(e){function t(){this.bg=document.createElement("audio"),this.bg.src=window.ossServer+"resource/music/bg.mp3?v="+window.resVersion,document.body.appendChild(this.bg)}function n(){this.musicSwitch&&PlayerMgr.ins.isTouchPhone&&(this.bg.loop=!0,this.bg.volume=.3,this.bg.play(-1))}function r(){this.bg&&this.bg.pause()}function i(e,t,n,r){var i=this;void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=0),this.soundSwitch&&PlayerMgr.ins.isTouchPhone&&RES.getResAsync(e+"_mp3",function(e){i.sound=e,null!=i.sound&&(i.sound.type=egret.Sound.EFFECT,i.channel=i.sound.play(r,n),i.channel.volume=t)},this)}e.musicSwitch=!1,e.soundSwitch=!0,e.initMusic=t,e.playBgMuisc=n,e.closeBgMuisc=r,e.playMuisc=i}(SoundMgr||(SoundMgr={}));var StageMgr=function(){function e(){this.baseGroup=new eui.Group,this.windowGroup=new eui.Group,this.tipGroup=new eui.Group}return Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.initStage=function(e){this.main=e,this.baseGroup.width=e.width,this.baseGroup.height=e.height,e.addChild(this.baseGroup),this.windowGroup.width=e.width,this.windowGroup.height=e.height,this.windowGroup.touchThrough=!0,e.addChild(this.windowGroup),this.tipGroup.width=e.width,this.tipGroup.height=e.height,this.tipGroup.touchThrough=!0,e.addChild(this.tipGroup)},e.prototype.loadBase=function(e){this.baseGroup.removeChildren(),this.baseGroup.addChild(e)},e.prototype.addWindow=function(e){this.windowGroup.addChild(e)},e.prototype.removeWindow=function(e){this.windowGroup.removeChild(e)},e.prototype.addTips=function(e,t,n,r){n&&(e.okFun=n),r&&(e.cancelFun=r),e.type=t,this.tipGroup.addChild(e)},e}();__reflect(StageMgr.prototype,"StageMgr");var VoiceMgr=function(){function e(){this.log=""}return Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.setBtn=function(e,t){var n=this;this.voiceBtn=e,this.loadObj=t,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnBegin,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBtnOutSide,this),EventMgr.ins.addEventListener(""+SELF_EVT.VOICE_STATUS_UPDATE,function(e){switch(console.log("iframe -- "+e.data.status),n.log+=" "+e.data.status+" "+egret.getTimer(),e.data.status){case 1:n.isStop||(console.log("开始录音"),n.sendMeStartVoice(),n.voiceStatus=2,t.addChild(new Voice),SoundMgr.closeBgMuisc(),n.startTime=egret.getTimer());break;case-1:n.voiceStatus=3;break;case 2:SoundMgr.playBgMuisc();break;case-2:n.voiceStatus=3,n.sendMeVoiceFail(),SoundMgr.playBgMuisc();break;case 3:EventMgr.ins.sendMessage({cmd:NET_CMD.CHAT_MSG,roleId:PlayerMgr.ins.roleId,msg:"v1o2i3c4e"+e.data.data});break;case-3:n.voiceStatus=3,n.sendMeVoiceFail();break;case 4:n.voiceStatus=5;break;case-4:n.voiceStatus=4;break;case 5:SoundMgr.closeBgMuisc();break;case-5:n.voiceStatus=4;break;case 6:n.init(),SoundMgr.playBgMuisc();break;case-6:n.init(),n.voiceStatus=4,SoundMgr.playBgMuisc()}},this),EventMgr.ins.addEventListener(""+NET_CMD.CHAT_MSG,function(e){var t=e.data.msg;if(-1!=t.search(/v1o2i3c4e/))IframeManager.ins.downloadRecord(t.slice(9));else if(-1!=t.search(/RECORDING/)){if(e.data.seat!=PlayerMgr.ins.seatNo)if(0!=n.voiceStatus){var r=parseInt(t.slice(9));console.log("自己的录音时间戳 -- "+n.timeStamp),(n.timeStamp>r||1==n.voiceStatus)&&(console.log("自己被强制停掉录音"),n.otherRecord=!0,n.stopVoice(!1,!0))}else n.otherRecord=!0}else-1!=t.search(/RECORDFAIL/)&&(e.data.seat==PlayerMgr.ins.seatNo?n.init():n.otherRecord=!1)},this)},e.prototype.stopVoice=function(e,t){var n=this;1==this.voiceStatus&&(this.isStop=!0,this.startTime=egret.getTimer());var r=egret.getTimer()-this.startTime;r>1e3?(console.log("超过1秒 -- shouldUpLoad == "+e),IframeManager.ins.stopRecord(e?1:0),EventMgr.ins.onEvt(SELF_EVT.STOP_VOICE,{enable:e,msg:t?"其他玩家正在录音":"录音取消"})):(console.log("没超过1秒钟"),egret.setTimeout(function(){IframeManager.ins.stopRecord(0),n.voiceStatus=0},this,1e3-r),EventMgr.ins.onEvt(SELF_EVT.STOP_VOICE,{enable:!1,msg:"录音时间过短"})),t&&(this.timeStamp=0,this.voiceStatus=0)},e.prototype.sendMeStartVoice=function(){console.log("广播自己录音成功"),EventMgr.ins.sendMessage({cmd:NET_CMD.CHAT_MSG,roleId:PlayerMgr.ins.roleId,msg:"RECORDING"+(this.timeStamp=Date.now())})},e.prototype.sendMeVoiceFail=function(){console.log("广播自己录音失败"),EventMgr.ins.sendMessage({cmd:NET_CMD.CHAT_MSG,roleId:PlayerMgr.ins.roleId,msg:"RECORDFAIL"})},e.prototype.onBtnBegin=function(){if(console.log("语音按钮 -- touchBegin"),this.otherRecord){console.log("提示其他玩家正在录音");var e=new Voice;e.once(egret.Event.ADDED_TO_STAGE,function(){EventMgr.ins.onEvt(SELF_EVT.STOP_VOICE,{enable:!1,msg:"其他玩家正在录音"})},this),this.loadObj.addChild(e)}else{if(1==this.voiceStatus||2==this.voiceStatus||5==this.voiceStatus)return;this.voiceStatus=1,console.log("开始录音11"),this.isStop=!1,IframeManager.ins.startRecord()}},e.prototype.onBtnTap=function(){this.otherRecord||(console.log("语音按钮 -- touchTap"),this.stopVoice(!0))},e.prototype.onBtnOutSide=function(){this.otherRecord||(console.log("语音按钮 -- outSide"),this.stopVoice(!1))},e.prototype.init=function(){console.log("初始化"),this.voiceStatus=0,this.otherRecord=!1,this.timeStamp=0},e.prototype.releaseBtn=function(){this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBtnBegin,this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this),this.voiceBtn.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onBtnOutSide,this),this.voiceBtn=null},e}();__reflect(VoiceMgr.prototype,"VoiceMgr");var Arrows=function(e){function t(){var t=e.call(this)||this;return t.timer=new egret.Timer(1e3),t.skinName=ArrowsSkin,t.timer.addEventListener(egret.TimerEvent.TIMER,t.onTimer,t),t}return __extends(t,e),t.prototype.upDate=function(e,t){this.currentState="status_"+e,null!=t&&(this.timeOut=t,this.text_time.text=""+t),this.startTimer(t)},t.prototype.startTimer=function(e){this.stopTimer(),0>=e||(this.timer.repeatCount=e,this.timer.reset(),this.timer.start())},t.prototype.stopTimer=function(){this.timer.running&&this.timer.stop()},t.prototype.onTimer=function(){var e=this.timeOut,t=e-1;e>0&&(this.text_time.text=""+t,this.timeOut--)},t}(eui.Component);__reflect(Arrows.prototype,"Arrows");var Card=function(e){function t(t,n,r){var i=e.call(this)||this;return i.skinName=CardSkin,i.serialNo=t,i.localSeatNo=n,i.type=r,i}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.currentState="c"+this.localSeatNo+"_"+this.type,this.setCard(this.serialNo),(2==this.type||3==this.type)&&EventMgr.ins.addEventListener(""+SELF_EVT.SELECTED_CARD,function(t){var n=t.data;e.isLight=0!=n&&n==e.serialNo},this)},t.prototype.setCard=function(e){if(this.serialNo=e,null!=e){if(0==e){var t=new eui.Image;switch(this.localSeatNo){case 1:t.source="card_bg_6_png";break;case 2:t.source="card_bg_4_png";break;case 3:t.source="card_bg_3_png",t.scaleX=1.1,t.scaleY=1.15;break;case 4:t.source="card_bg_4_png"}t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t),this.img_bg.visible=!1,this.img_serialNo.visible=!1}else-1!=e&&(this.img_serialNo.source="card_"+e+"_png");this.visible=!0}},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this._isSelected},set:function(e){this._isSelected=e,this.isSelected?(this.showEff(this.img_bg,-20),this.showEff(this.img_serialNo,-10),this.img_wild&&this.showEff(this.img_wild,-41)):(this.showEff(this.img_bg,0),this.showEff(this.img_serialNo,10),this.img_wild&&this.showEff(this.img_wild,-21))},enumerable:!0,configurable:!0}),t.prototype.showEff=function(e,t){egret.Tween.get(e).to({verticalCenter:t},80)},Object.defineProperty(t.prototype,"serialNo",{get:function(){return this._serialNo},set:function(e){this._serialNo=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGray",{get:function(){return this._isGray},set:function(e){this._isGray=e,this.rect_gary&&(e?this.rect_gary.visible=!0:this.rect_gary.visible=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLight",{get:function(){return this._isLight},set:function(e){this.isLight!=e&&(this._isLight=e,this.rect_light&&(e?(this.rect_light.visible=!0,this.showLight()):(this.rect_light.visible=!1,this.hideLight())))},enumerable:!0,configurable:!0}),t.prototype.showLight=function(){var e=this,t=function(){egret.Tween.get(e.rect_light).set({fillAlpha:0}).to({fillAlpha:.4},450).to({fillAlpha:0},450)};t(),this.lightInterval=egret.setInterval(function(){t()},this,1e3)},t.prototype.hideLight=function(){egret.clearInterval(this.lightInterval)},t}(eui.Component);__reflect(Card.prototype,"Card");var CardDesk=function(e){function t(){var t=e.call(this)||this;return t.putProp={maxCard:11,s2y:35,s2x:59,s2firstY:350,s3x:42,s3y:48,s3firstX:420,s3firstY:96},t.putCardPoint={2:[940,307],3:[554,80],4:[167,307]},t.skinName=CardDeskSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;HuCardTipsMgr.ins.start(),EventMgr.ins.addEventListener(""+NET_CMD.DEAL_CARD,function(t){e.initDesk();var n=t.data,r=PlayerMgr.ins.getLocalSeatNo(PlayerMgr.ins.bankerSeatId=n.bankerSeatId);PlayerMgr.ins.lastPutSeatNo=n.bankerSeatId;var i=n.cardsList.slice(),a=e.g_c1.getChildByName("g_card");i.sort(Utils.sortCard),i.length>13&&e.card_mo.setCard(i.pop()),i.forEach(function(e,t){a.addChild(new Card(e,1,1))},e);for(var s=2;5>s;s++){for(var o=e["g_c"+s].getChildByName("g_card"),c=0;13>c;c++)o.addChild(new Card(-1,s,1));r==s&&o.addChild(new Card(-1,s,1))}EventMgr.ins.onEvt(SELF_EVT.UPDATE_BANKER,r),e.txt_cardNum.text=""+n.cardPoolNum,PlayerMgr.ins.isExchange3&&(PlayerMgr.ins.currentGameStatus=3,e.addChild(new Exchange3(e.g_c1.getChildByName("g_card"))),e.c_arrows.upDate(0,18))},this),EventMgr.ins.addEventListener(""+NET_CMD.TOUCH_CARD,function(t){var n=t.data.touchCard,r=PlayerMgr.ins.getLocalSeatNo(t.data.touchSeat);e.addOneCardToHand(r,n),e.txt_cardNum.text=""+t.data.cardPoolNum,e.c_arrows.upDate(r,PlayerMgr.ins.putTimeOut),PlayerMgr.ins.curThinkPlayerLocalSeat=r,e.pgh&&e.pgh.visible&&e.pgh.init(),PlayerMgr.ins.lastPutSeatNo=t.data.touchSeat,1==r&&e.upDateMeHandCardByLack(e.lackType)},this),EventMgr.ins.addEventListener(""+NET_CMD.PUT_CARD,function(t){var n=t.data.putCard,r=PlayerMgr.ins.getLocalSeatNo(t.data.putSeatId),i=new Card(n,r,3);e.addOnePutCard(i,r),e.showPutArrow(i),e.showPutCard(n,r),e.playCardSound(n,t.data.putSeatId),e.deleteOneCardFromHand(r,n),e.selectedCard&&e.selectedCard.isSelected&&(e.selectedCard.isSelected=!1),e.selectedCard=null,EventMgr.ins.onEvt(SELF_EVT.SELECTED_CARD,0),PlayerMgr.ins.lastPutSeatNo=t.data.putSeatId,1==r&&e.upDateMeHandCardByLack(e.lackType)},this),EventMgr.ins.addEventListener(""+NET_CMD.CHANGE_3,function(t){PlayerMgr.ins.currentGameStatus=4;var n,r=t.data.changeType;switch(r){case 1:n=PlayerMgr.ins.seatNo-1>0?PlayerMgr.ins.seatNo-1:4;break;case 2:n=PlayerMgr.ins.seatNo+1<=4?PlayerMgr.ins.seatNo+1:1;break;case 3:n=PlayerMgr.ins.seatNo+2<=4?PlayerMgr.ins.seatNo+2:(PlayerMgr.ins.seatNo+2)%4}t.data.exchangeAfter[n].forEach(function(t){e.deleteOneCardFromHand(1,t)}),t.data.exchangeAfter[PlayerMgr.ins.seatNo].forEach(function(t){if(PlayerMgr.ins.bankerSeatId==PlayerMgr.ins.seatNo)e.addOneCardToHand(1,t);else for(var n=e.g_c1.getChildByName("g_card"),r=n.numChildren,i=new Card(t,1,1),a=0;r>a;a++){var s=n.getChildAt(a);if(i.serialNo<s.serialNo||a==r-1){n.addChildAt(i,i.serialNo<s.serialNo?a:a+1);break}}})},this),EventMgr.ins.addEventListener(""+NET_CMD.TIPS_LACK,function(t){e.c_arrows.upDate(0,18),e.addChild(new DoLack(t.data.recommendLack))},this),EventMgr.ins.addEventListener(""+NET_CMD.DO_LACK,function(t){PlayerMgr.ins.curThinkPlayerLocalSeat=PlayerMgr.ins.getLocalSeatNo(PlayerMgr.ins.bankerSeatId),e.c_arrows.upDate(PlayerMgr.ins.curThinkPlayerLocalSeat,PlayerMgr.ins.putTimeOut);for(var n in t.data.seatId_lack){var r=PlayerMgr.ins.getLocalSeatNo(parseInt(n));EventMgr.ins.onEvt(SELF_EVT.UPDATE_LACK,{seatId:n,lack:t.data.seatId_lack[n]}),1==r&&(e.lackType=t.data.seatId_lack[n])}e.upDateMeHandCardByLack(e.lackType)},this),EventMgr.ins.addEventListener(""+NET_CMD.PENG_GANG_SHOW,function(t){e.pgh||e.addChild(e.pgh=new PGH),e.pgh.showBtn(t.data)},this),EventMgr.ins.addEventListener(""+NET_CMD.PENG_GANG,function(t){if(t.data.huCard){if(t.data.seatId==PlayerMgr.ins.seatNo){for(var n=e.g_c1.getChildByName("g_card"),r=n.numChildren,i=0;r>i;i++){var a=n.getChildAt(i);a.isGray=!0}e.card_mo.setCard(t.data.huCard),e.card_mo.isGray=!0}else{for(var s=PlayerMgr.ins.getLocalSeatNo(t.data.seatId),o=e["g_c"+s].getChildByName("g_card"),r=o.numChildren,i=0;r>i;i++){var a=o.getChildAt(i);a.setCard(0)}3==s?o.layout.gap=-35:o.layout.gap=-75,4==s?o.addChild(new Card(t.data.huCard,s,2)):o.addChildAt(new Card(t.data.huCard,s,2),0)}e.deleteOnePutCard(t.data.huCard,PlayerMgr.ins.getLocalSeatNo(PlayerMgr.ins.lastPutSeatNo)),e.playPGHSound(t.data.huType,t.data.seatId);var c=e["show_hu_"+PlayerMgr.ins.getLocalSeatNo(t.data.seatId)];c.source="show_"+(5==t.data.huType?"zimo":"hu")+"_png",c.visible=!0,e.g_showPut.visible=!1}else{var d=t.data.data.type,a=t.data.data.card,h=PlayerMgr.ins.getLocalSeatNo(t.data.seatId),l=void 0;switch(t.data.data.type){case 1:l=2;break;case 2:l=1;break;case 3:l=4;break;case 4:l=3}for(var i=0;l>i;i++)e.deleteOneCardFromHand(h,a);e.addOnePengGang(a,h,d),e.deleteOnePutCard(a,PlayerMgr.ins.getLocalSeatNo(PlayerMgr.ins.lastPutSeatNo)),e.c_arrows.upDate(h,PlayerMgr.ins.putTimeOut),e.g_showPut.visible=!1,e.playPGHSound(d,t.data.seatId),PlayerMgr.ins.curThinkPlayerLocalSeat=h}},this),EventMgr.ins.addEventListener(""+NET_CMD.SETTLEMENT_SMALL,function(t){e.initDesk()},this),this.g_c1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){if(3!=PlayerMgr.ins.currentGameStatus){var n=t.target.parent;n.isSelected&&1==PlayerMgr.ins.curThinkPlayerLocalSeat?egret.is(n,"Card")&&EventMgr.ins.sendMessage({cmd:NET_CMD.PUT_CARD,putCard:n.serialNo}):(n.isSelected=!n.isSelected,n.isSelected?(null!=e.selectedCard&&(e.selectedCard.isSelected=!1),e.selectedCard=n,EventMgr.ins.onEvt(SELF_EVT.SELECTED_CARD,n.serialNo)):(e.selectedCard=null,EventMgr.ins.onEvt(SELF_EVT.SELECTED_CARD,0)))}},this),EventMgr.ins.addEventListener(""+SELF_EVT.CAN_HU_CARD,function(t){e.addChild(new TipsHu(t.data))},this),PlayerMgr.ins.currentGameStatus>2&&7!=PlayerMgr.ins.currentGameStatus&&this.resetCardDesk()},t.prototype.initDesk=function(){for(var e=1;5>e;e++)this["g_c"+e].getChildByName("g_card").removeChildren(),this["g_c"+e].getChildByName("g_pg").removeChildren(),this["g_s"+e].removeChildren();this.show_hu_1.visible=!1,this.show_hu_2.visible=!1,this.show_hu_3.visible=!1,this.show_hu_4.visible=!1,this.card_mo.visible=!1,this.card_mo.isSelected=!1,this.selectedCard=null,this.g_showPut.visible=!1,this.lackType=0,this.pgh&&this.pgh.visible&&this.pgh.init(),this.c_arrows.upDate(0,0),this.movePutArrow(),this.visible=!1;
for(var e=2;5>e;e++){var t=this["g_c"+e].getChildByName("g_card");3==e?t.layout.gap=-40:t.layout.gap=-84}},t.prototype.addOneCardToHand=function(e,t){if(1==e)this.card_mo.visible&&this.moveMoCardToHand(1),this.card_mo.setCard(t);else{var n=this["g_c"+e].getChildByName("g_card");n.addChild(new Card(-1,e,1))}},t.prototype.deleteOneCardFromHand=function(e,t){if(1==e){var n=this.g_c1.getChildByName("g_card"),r=n.numChildren,i=void 0;for(i=0;r>i;i++){var a=n.getChildAt(i);if(a.serialNo==t){n.removeChild(a),this.moveMoCardToHand(1);break}}if(i==r){var s=this.card_mo;s.visible&&s.serialNo==t?s.visible=!1:egret.error("删除一张手牌出错：没有找到这张牌 -- ",t)}}else{var o=this["g_c"+e].getChildByName("g_card");o.removeChildAt(0)}},t.prototype.moveMoCardToHand=function(e){if(1==e){var t=this.card_mo;if(!t.visible)return;for(var n=this.g_c1.getChildByName("g_card"),r=n.numChildren,i=new Card(t.serialNo,1,1),a=0;r>a;a++){var s=n.getChildAt(a);if(i.serialNo<s.serialNo||a==r-1){n.addChildAt(i,i.serialNo<s.serialNo?a:a+1),t.visible=!1;break}}}},t.prototype.addOnePutCard=function(e,t){var n=this.putProp;if(2==t){var r=this["g_s"+t].numChildren;e.x=Math.floor(r/n.maxCard)*n.s2x,e.y=n.s2firstY-(r<n.maxCard?r+n.maxCard:r)%n.maxCard*n.s2y,this["g_s"+t].addChildAt(e,0)}else if(3==t){var r=this["g_s"+t].numChildren;e.x=n.s3firstX-(r<n.maxCard?r+n.maxCard:r)%n.maxCard*n.s3x,e.y=n.s3firstY-Math.floor(r/n.maxCard)*n.s3y,this["g_s"+t].addChildAt(e,0)}else this["g_s"+t].addChild(e)},t.prototype.deleteOnePutCard=function(e,t){var n=this["g_s"+t];if(n)try{var r=void 0;r=2==t||3==t?n.getChildAt(0):n.getChildAt(n.numChildren-1),r.serialNo==e?n.removeChild(r):egret.error("deleteOnePutCard -- 移除单张出牌区失败 -- ",e," -- ",r.serialNo)}catch(i){egret.error("出牌区为空")}},t.prototype.addOnePengGang=function(e,t,n){var r=this["g_c"+t].getChildByName("g_pg");if(2==n){for(var i=0;i<r.numChildren;i++)if(r.getChildAt(i).serialNo==e){r.removeChildAt(i),r.addChildAt(new CardPG(e,t,n),i);break}}else r.addChild(new CardPG(e,t,n))},t.prototype.upDateMeHandCardByLack=function(e){if(e){for(var t=this.g_c1.getChildByName("g_card"),n=!1,r=this.card_mo,i=0;i<t.numChildren;i++){var a=t.getChildAt(i);if(this.getLack(a.serialNo)==e){n=!0;break}}r.visible&&this.getLack(r.serialNo)==e&&(n=!0),PlayerMgr.ins.isLack=!n;for(var i=0;i<t.numChildren;i++){var a=t.getChildAt(i);this.getLack(a.serialNo)==e?a.isGray=!1:a.isGray=n}r.visible&&(this.getLack(r.serialNo)==e?r.isGray=!1:r.isGray=n);for(var s=0,i=0;i<t.numChildren;i++){var a=t.getChildAt(s);this.getLack(a.serialNo)==e&&(t.setChildIndex(a,-1),s--),s++}t.$children}},t.prototype.getLack=function(e){return 0==~~(e/10)?1:2==~~(e/10)?2:3},t.prototype.showPutCard=function(e,t){var n=this.g_showPut;if(1==t)return void(n.visible=!1);n.visible=!0;var r=this.putCardPoint[t];n.x=r[0],n.y=r[1],n.getChildByName("card").setCard(e)},t.prototype.showPutArrow=function(e){var t=this;if(!this.cardArrow){var n=new eui.Image("selected_card_arrow_png");this.cardArrow=new eui.Group,this.cardArrow.addChild(n),this.cardArrow.x=25,this.cardArrow.y=20;var r=function(){t.cardArrow&&n&&egret.Tween.get(n).set({y:0}).to({y:5},250).wait(250).to({y:0},250).wait(250).call(r)};r()}this.movePutArrow(),e.addChild(this.cardArrow)},t.prototype.movePutArrow=function(){var e=this.cardArrow;e&&e.parent&&e.parent.removeChild(e)},t.prototype.playCardSound=function(e,t){try{for(var n=PlayerMgr.ins.userArr[t].player.sex,r=""+(1==n?"man":"woman")+e+"_",i=0;33>i;i++){var a=Utils.randomFrom(1,4);if(RES.hasRes(""+r+a+"_mp3")){SoundMgr.playMuisc(""+r+a);break}}}catch(s){console.log("播放音效失败 -- "+s)}},t.prototype.playPGHSound=function(e,t){var n=PlayerMgr.ins.userArr[t].player.sex,r=(1==n?"man":"woman")+"_";switch(e){case 4:r+="2_";break;default:r+=e+"_"}for(var i=0;33>i;i++){var a=Utils.randomFrom(1,4);if(RES.hasRes(""+r+a+"_mp3")){SoundMgr.playMuisc(""+r+a);break}32==i&&SoundMgr.playMuisc(r+"1")}},t.prototype.resetCardDesk=function(){var e=this,t=PlayerMgr.ins.userArr;Object.keys(t).forEach(function(n){var r=t[n],i=PlayerMgr.ins.getLocalSeatNo(r.seatId);!r.isHu&&[2,5,8,11,14].some(function(e){return e==r.handCards.length})&&(e.c_arrows.upDate(i,0),PlayerMgr.ins.curThinkPlayerLocalSeat=i);var a;if(PlayerMgr.ins.lastPutSeatNo==PlayerMgr.ins.seatNo&&1==PlayerMgr.ins.curThinkPlayerLocalSeat){e.card_mo.setCard(PlayerMgr.ins.lastPutCard);var s=r.handCards.indexOf(PlayerMgr.ins.lastPutCard);a=r.handCards.filter(function(e,t){return t!=s})}else a=r.handCards;if(a&&1==i){a.sort(Utils.sortCard),r.isHu&&delete a[a.indexOf(r.huData.huCard)];var o=e.g_c1.getChildByName("g_card");a.forEach(function(e){o.addChild(new Card(e,1,1))},e)}if(1!=i&&a)for(var c=e["g_c"+i].getChildByName("g_card"),d=0;d<a.length;d++)c.addChild(new Card(-1,i,1));if(r.pGDate){var h=e["g_c"+i].getChildByName("g_pg");r.pGDate.forEach(function(e){h.addChild(new CardPG(e.card,i,e.type))},e)}if(r.putCards&&r.putCards.forEach(function(t){e.addOnePutCard(new Card(t,i,3),i)},e),r.lack&&(EventMgr.ins.onEvt(SELF_EVT.UPDATE_LACK,{seatId:n,lack:r.lack}),1==i&&e.upDateMeHandCardByLack(e.lackType=r.lack)),1==i&&0!=r.pghInfo.length&&(e.pgh||e.addChild(e.pgh=new PGH),e.pgh.showBtn({canGang:r.pghInfo.some(function(e){return 2==e[0]}),canHu:r.pghInfo.some(function(e){return 1==e[0]}),canPeng:r.pghInfo.some(function(e){return 3==e[0]}),gangArr:r.pghInfo,putCard:PlayerMgr.ins.lastPutCard})),r.isHu){if(1==i){for(var l=e.g_c1.getChildByName("g_card"),u=l.numChildren,d=0;u>d;d++){var g=l.getChildAt(d);g.isGray=!0}e.card_mo.setCard(r.huData.huCard),e.card_mo.isGray=!0}else{var p=e["g_c"+i].getChildByName("g_card"),u=p.numChildren-1;p.removeChildAt(0);for(var d=0;u>d;d++){var g=p.getChildAt(d);g.setCard(0)}3==i?p.layout.gap=-35:p.layout.gap=-75,4==i?p.addChild(new Card(r.huData.huCard,i,2)):p.addChildAt(new Card(r.huData.huCard,i,2),0)}var _=e["show_hu_"+i];_.source="show_"+(5==r.huData.endType?"zimo":"hu")+"_png",_.visible=!0}},this),this.txt_cardNum.text=""+PlayerMgr.ins.resetGameCardNum,this.visible=!0},t}(eui.Component);__reflect(CardDesk.prototype,"CardDesk");var CardPG=function(e){function t(t,n,r){var i=e.call(this)||this;return i.skinName=CardPGSkin,i._serialNo=t,i.localSeatNo=n,i.cardType=r,i}return __extends(t,e),t.prototype.childrenCreated=function(){this.currentState="p"+this.localSeatNo;for(var e=0;3>e;e++)this.g_card.addChild(new Card(this.serialNo,this.localSeatNo,2));1==this.cardType?this.c_top.visible=!1:2==this.cardType||4==this.cardType?this.c_top.addChild(new Card(this.serialNo,this.localSeatNo,2)):3==this.cardType&&this.c_top.addChild(new Card(0,this.localSeatNo,2))},Object.defineProperty(t.prototype,"serialNo",{get:function(){return this._serialNo},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(CardPG.prototype,"CardPG");var Chat=function(e){function t(){var t=e.call(this)||this;return t.skinName=ChatSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init(),this.addEvent()},t.prototype.init=function(){this.rbtn_talk.selected=!0,this.g_talk.visible=!0;var e=PlayerMgr.ins.getPlayerForSeatNo(PlayerMgr.ins.seatNo).player.sex,t=[{lb:"你们耍得安逸哦，我也来参一个。"},{lb:(1==e?"美女":"帅哥")+"，你割啥子，我打给你哇。"},{lb:"下好叫，割猫儿胡，做大做强么得前途。"},{lb:"紧到摸不到，只有割你咯。"},{lb:"催啥子，我在想割哪张。"},{lb:"点花儿我也割了哈，不得再放你娃些咯。"},{lb:"几哈打撒，瞌睡都等出来咯。"},{lb:"哎，快点打撒，紧到悬啥子喃。"},{lb:"速度些撒，都又少打两盘了。"},{lb:"幺鸡、二条，不打要遭。"},{lb:"搞个串串哦，咋又遭点炮了。"},{lb:"嘿，上碰下自摸哦。"},{lb:"输家不开口，赢家不许走哈。"},{lb:"你娃打得好哦，麻胡都整出来了。"},{lb:"你们太要不得了，咋只晓得按到我割喃。"},{lb:"今天输安逸了，下盘再来收拾你们。"},{lb:"再打一盘我走了哈，你们慢慢耍。"}];this.list_talk.dataProvider=new eui.ArrayCollection(t)},t.prototype.addEvent=function(){this.rbtn_face.addEventListener(egret.Event.CHANGE,this.onTab,this),this.rbtn_talk.addEventListener(egret.Event.CHANGE,this.onTab,this),this.rect_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDistory,this),this.list_talk.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTalkTap,this),this.faceGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceTap,this)},t.prototype.onTab=function(e){switch(e.currentTarget){case this.rbtn_talk:this.g_talk.visible=!0,this.g_face.visible=!1;break;case this.rbtn_face:this.g_face.visible=!0,this.g_talk.visible=!1}},t.prototype.onTalkTap=function(e){var t=e.currentTarget.selectedIndex+"INDEX";this.sendMsg(t+e.currentTarget.selectedItem.lb)},t.prototype.onFaceTap=function(e){var t="f1a2c3e4";egret.is(e.target,"eui.Image")&&this.sendMsg(t+e.target.source.slice(0,e.target.source.length-4))},t.prototype.sendMsg=function(e){EventMgr.ins.sendMessage({cmd:NET_CMD.CHAT_MSG,roleId:PlayerMgr.ins.roleId,msg:PlayerMgr.ins.seatNo+"|"+e}),this.onDistory()},t.prototype.onDistory=function(){this.rbtn_face.removeEventListener(egret.Event.CHANGE,this.onTab,this),this.rbtn_talk.removeEventListener(egret.Event.CHANGE,this.onTab,this),this.rect_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDistory,this),this.list_talk.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTalkTap,this),this.faceGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onFaceTap,this),e.prototype.dispose.call(this)},t}(EffectWindow);__reflect(Chat.prototype,"Chat");var DissolveRoom=function(e){function t(t,n){void 0===t&&(t=!1);var r=e.call(this)||this;return r.skinName=DissolveRoomSkin,r.isOtherLaunch=t,r.launchSeatId=n,r}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initPlayer(),EventMgr.ins.addEventListener(""+NET_CMD.DISSOLVE_GAME,this.onDissolve,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn1Tap,this),this.btn_sure.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn1Tap,this),this.btn_reject.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn2Tap,this),this.btn_agree.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn2Tap,this),this.isOtherLaunch&&this.showAgree(this.launchSeatId)},t.prototype.initPlayer=function(){var e=this,t=PlayerMgr.ins.userArr;Object.keys(t).forEach(function(n,r){e["img_head"+n].source=t[n].player.headImgUrl,e["txt_name"+n].text=t[n].player.nickname},this)},t.prototype.onDissolve=function(e){var t=e.data.seatId;t==PlayerMgr.ins.seatNo&&(this.txt_2_text.visible=!0,this.g_2_btn.visible=!1);var n=e.data.status;switch(n){case 1:this.showAgree(t);break;case 4:this.onDestroy();break;case 2:this.showAgree(t);break;case 3:var r=this["img_status"+t];r.source="dissolve_reject_png",r.visible=!0;break;case 5:StageMgr.ins.addTips(new Tips("房间解散失败"),1),this.onDestroy()}},t.prototype.showAgree=function(e){var t=this;if(!this.pgs_time){var n=this.img_pgs;this.pgs_time=egret.setInterval(function(){n.width-=739/150,n.width<=0&&(n.width=0,egret.clearInterval(t.pgs_time))},this,100)}this.currentState="step_2",this["img_status"+e].visible=!0},t.prototype.onBtn1Tap=function(e){switch(e.currentTarget){case this.btn_cancel:this.onDestroy();break;case this.btn_sure:EventMgr.ins.sendMessage({cmd:NET_CMD.DISSOLVE_GAME,status:1})}},t.prototype.onBtn2Tap=function(e){switch(e.currentTarget){case this.btn_reject:EventMgr.ins.sendMessage({cmd:NET_CMD.DISSOLVE_GAME,status:3});break;case this.btn_agree:EventMgr.ins.sendMessage({cmd:NET_CMD.DISSOLVE_GAME,status:2})}},t.prototype.onDestroy=function(){this.pgs_time&&egret.clearInterval(this.pgs_time),EventMgr.ins.removeEventListener(""+NET_CMD.DISSOLVE_GAME,this.onDissolve,this),this.btn_cancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn1Tap,this),this.btn_sure.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn1Tap,this),this.btn_reject.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn2Tap,this),this.btn_agree.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtn2Tap,this),e.prototype.dispose.call(this)},t}(EffectWindow);__reflect(DissolveRoom.prototype,"DissolveRoom");var LoadingUI=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setProgress=function(e,t){IframeManager.ins.sendMessage({forLobby:!0,cmd:"loading",percent:e/t*.5+.5})},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Exchange3=function(e){function t(t){var n=e.call(this)||this;return n.selectedCards=[],n.skinName=Exchange3Skin,n.meHandCard=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.horizontalCenter=0,this.bottom=150;var t,n,r,i;this.meHandCard.addEventListener(egret.TouchEvent.TOUCH_TAP,t=function(t){var n=t.target.parent;if(n.isSelected)try{n.isSelected=!1,e.selectedCards.splice(e.selectedCards.indexOf(n),1)}catch(r){egret.error("取消单张牌失败 -- ",n)}else e.selectedCards.length<3&&(n.isSelected=!0,e.selectedCards.push(n))},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,n=function(){e.selectedCards.forEach(function(e){e.isSelected=!1}),e.selectedCards=[]},this),this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,r=function(){e.selectedCards.length<3||(EventMgr.ins.sendMessage({cmd:NET_CMD.CHANGE_3,exchange3:e.selectedCards.map(function(e){return e.serialNo},e)}),e.selectedCards.forEach(function(e){e.isSelected=!1}),e.selectedCards=[],e.parent.removeChild(e))},this),EventMgr.ins.addEventListener(""+NET_CMD.CHANGE_3,i=function(){e.parent.removeChild(e)},this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.meHandCard.removeEventListener(egret.TouchEvent.TOUCH_TAP,t,e),e.btn_reset.removeEventListener(egret.TouchEvent.TOUCH_TAP,n,e),e.btn_exchange.removeEventListener(egret.TouchEvent.TOUCH_TAP,r,e),EventMgr.ins.removeEventListener(""+NET_CMD.CHANGE_3,i,e)},this)},t}(eui.Component);__reflect(Exchange3.prototype,"Exchange3");var GameRoom=function(e){function t(){var t=e.call(this)||this;return t.roomInterval=0,t.interActionTimeOut=[260,278,100,270,40,278],t.skinName=GameRoomSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){this.initDesk(),this.addListener(),IframeManager.ins.initWxShare("血战麻将 -- 房间号："+PlayerMgr.ins.roomId,"老总，这有笔生意，三位老板都在等着您呢，快来啊，好机会不能错过啊。",PlayerMgr.ins.headImg),this.stage.once(egret.TouchEvent.TOUCH_TAP,function(){RES.getRes("nullSound_mp3").play(0,1),PlayerMgr.ins.isTouchPhone=!0,SoundMgr.initMusic(),SoundMgr.playBgMuisc()},this)},t.prototype.initDesk=function(){var e=this;this.btn_ready.visible=PlayerMgr.ins.currentGameStatus<3||7==PlayerMgr.ins.currentGameStatus,this.txt_roomId.text="房间号："+PlayerMgr.ins.roomId,this.txt_roundNum.text=1==PlayerMgr.ins.roomMode?"剩余时长："+Utils.formatTime(PlayerMgr.ins.balanceTime):"局数："+PlayerMgr.ins.currentRound+"/"+PlayerMgr.ins.totalRound,this.initPlayer(),VoiceMgr.ins.setBtn(this.btn_voice,this.g_talk),PlayerMgr.ins.balanceTime!=60*PlayerMgr.ins.totalTime&&1==PlayerMgr.ins.roomMode&&(this.roomInterval=setInterval(function(){e.txt_roundNum.text="房间时间："+Utils.formatTime(--PlayerMgr.ins.balanceTime),PlayerMgr.ins.balanceTime<=0&&clearInterval(e.roomInterval)},1e3))},t.prototype.initPlayer=function(){for(var e=this,t=1;5>t;t++)this["user_"+t].visible=!1;var n=PlayerMgr.ins.userArr;Object.keys(n).forEach(function(t){e["user_"+PlayerMgr.ins.getLocalSeatNo(n[t].seatId)].initUser({nick:n[t].player.nickname,headUrl:n[t].player.headImgUrl,score:n[t].totalScore,seat:n[t].seatId,isBanker:PlayerMgr.ins.currentGameStatus>2&&7!=PlayerMgr.ins.currentGameStatus&&PlayerMgr.ins.bankerSeatId==n[t].seatId,lack:n[t].lack}),e["img_ready"+PlayerMgr.ins.getLocalSeatNo(n[t].seatId)].visible=n[t].isReady&&(PlayerMgr.ins.currentGameStatus<3||7==PlayerMgr.ins.currentGameStatus),n[t].seatId==PlayerMgr.ins.seatNo&&(e.btn_ready.icon="ready_btn_"+(n[t].isReady?"5":"4")+"_png")},this),4==Object.keys(n).length&&(this.btn_invite.visible=!1)},t.prototype.addListener=function(){var e=this;this.btn_ready.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){EventMgr.ins.sendMessage({cmd:NET_CMD.READY,roleId:PlayerMgr.ins.roleId,isReady:!PlayerMgr.ins.getPlayerForSeatNo(PlayerMgr.ins.seatNo).isReady})},this),this.btn_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){StageMgr.ins.addWindow(new Share(1))},this),this.btn_menu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){StageMgr.ins.addWindow(new Menu)},this),EventMgr.ins.addEventListener(""+SELF_EVT.CLICK_MENU,this.onClickMenu,this),this.btn_set.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){StageMgr.ins.addWindow(new Setting)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){StageMgr.ins.addWindow(new Chat)},this),EventMgr.ins.addEventListener(""+NET_CMD.READY,function(t){var n=PlayerMgr.ins.userArr[t.data.seatId].isReady=t.data.isReady;e["img_ready"+PlayerMgr.ins.getLocalSeatNo(t.data.seatId)].visible=n,t.data.seatId==PlayerMgr.ins.seatNo&&(e.btn_ready.icon="ready_btn_"+(n?"5":"4")+"_png"),e.settlementSmall&&1==PlayerMgr.ins.getLocalSeatNo(t.data.seatId)&&(e.settlementSmall.dispose(),null==e.settlementSmall)},this),EventMgr.ins.addEventListener(""+NET_CMD.DEAL_CARD,function(t){PlayerMgr.ins.gameIsStarted=!0,e.btn_invite.visible=!1,e.btn_ready.visible=!1,e.img_ready1.visible=!1,e.img_ready2.visible=!1,e.img_ready3.visible=!1,e.img_ready4.visible=!1,e.showDice(t.data.diceNum),0==e.roomInterval&&1==PlayerMgr.ins.roomMode?e.roomInterval=setInterval(function(){e.txt_roundNum.text="房间时间："+Utils.formatTime(--PlayerMgr.ins.balanceTime),PlayerMgr.ins.balanceTime<=0&&clearInterval(e.roomInterval)},1e3):2==PlayerMgr.ins.roomMode&&(e.txt_roundNum.text="局数："+(PlayerMgr.ins.currentRound=t.data.round)+"/"+PlayerMgr.ins.totalRound)},this),EventMgr.ins.addEventListener(""+NET_CMD.GET_ROOM_INFO,function(t){if(t.data.seatData)try{var n=t.data.seatData.player,r=e["user_"+PlayerMgr.ins.getLocalSeatNo(t.data.seatData.seatId)];r.initUser({nick:n.nickname,headUrl:n.headImgUrl,score:t.data.seatData.totalScore,seat:t.data.seatData.seatId,isBanker:!1,lack:t.data.seatData.lack}),r.setPlayerStatus(1),PlayerMgr.ins.userArr[t.data.seatData.seatId]=t.data.seatData,4==Object.keys(PlayerMgr.ins.userArr).length&&(e.btn_invite.visible=!1),e.addChild((new Notificat).setTextFlow([{text:"欢迎玩家 "},{text:n.nickname,style:{textColor:43775}},{text:" 进入房间"}]))}catch(i){console.log("玩家加入房间数据错误")}},this),EventMgr.ins.addEventListener(""+NET_CMD.LEAVE_GAME,function(t){if(7!=PlayerMgr.ins.currentGameStatus){var n=t.data.seatId;e["user_"+PlayerMgr.ins.getLocalSeatNo(n)].removeUser(),e["img_ready"+PlayerMgr.ins.getLocalSeatNo(n)].visible=!1,e.addChild((new Notificat).setTextFlow([{text:"玩家 "},{text:PlayerMgr.ins.getPlayerForSeatNo(n).player.nickname,style:{textColor:43775}},{text:" 离开房间"}])),delete PlayerMgr.ins.userArr[n],e.btn_invite.visible=!0,n==PlayerMgr.ins.seatNo&&StageMgr.ins.addTips(new Tips("您已经离开房间"),1,function(){IframeManager.ins.backToHall()})}},this),EventMgr.ins.addEventListener(""+NET_CMD.PLAYER_DISCONNECT,function(t){var n=PlayerMgr.ins.getLocalSeatNo(t.data.disconnectSeatId);e["user_"+n].setPlayerStatus(0)},this),EventMgr.ins.addEventListener(""+NET_CMD.DISSOLVE_GAME,function(e){1==e.data.status?1!=PlayerMgr.ins.getLocalSeatNo(e.data.seatId)&&StageMgr.ins.addWindow(new DissolveRoom(!0,e.data.seatId)):4==e.data.status&&StageMgr.ins.addTips(new Tips("房间解散成功"),1,function(){IframeManager.ins.backToHall()})},this),EventMgr.ins.addEventListener(""+NET_CMD.SETTLEMENT_SMALL,function(t){e.cardDesk.visible=!1,StageMgr.ins.addWindow(e.settlementSmall=new SettlementSmall(t.data));for(var n=1;5>n;n++){var r=e["user_"+n];r.lack="",r.isBanker=!1}},this),EventMgr.ins.addEventListener(""+NET_CMD.SETTLEMENT_TOTAL,function(e){PlayerMgr.ins.totalSettlement=e.data.seatId_totalCountData},this),EventMgr.ins.addEventListener(""+NET_CMD.UPDATE_SCORE,function(e){var t=e.data.seatId_changeScore;for(var n in t)EventMgr.ins.onEvt(SELF_EVT.UPDATE_SCORE,{seat:n,score:t[n]})},this),EventMgr.ins.addEventListener(""+NET_CMD.CHAT_MSG,function(t){var n=t.data.msg.split("|")[1],r=t.data.msg.split("|")[0],i=PlayerMgr.ins.getLocalSeatNo(r);if(-1!=n.search(/f1a2c3e4/))n=n.slice(8),DragonMgr.ins.playDragon(e["user_"+i],"face",n,"newAnimation",{dx:55,dy:90,playTimes:1});else if(-1!=n.search(/INDEX/)){var a=n.split("INDEX");e.g_talk.addChild(new Talk(i,a[1]));var s=PlayerMgr.ins.getPlayerForSeatNo(r).player.sex,o=(1==s?"man":"woman")+"_chat"+a[0];SoundMgr.playMuisc(o)}else-1!=n.search(/i1n2t3e4r5a6c7t8i9o0n/)?(n=n.slice(21),e.showInterActionFace(n.split("_"))):-1!=n.search(/v1o2i3c4e/)?e["user_"+i].showVoice():console.log("未处理chat命令 -- "+n)},this),EventMgr.ins.addEventListener(""+SELF_EVT.VOICE_STATUS_UPDATE,function(t){(6==t.data.status||-6==t.data.status)&&(e.user_1.hideVoice(),e.user_2.hideVoice(),e.user_3.hideVoice(),e.user_4.hideVoice())},this);for(var t=1;5>t;t++)this["user_"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=e.currentTarget.seat,n=PlayerMgr.ins.userArr[t];n&&StageMgr.ins.addWindow(new UserInfo(n))},this);EventMgr.ins.addEventListener(""+SELF_EVT.UPDATE_BANKER,function(t){for(var n=1;5>n;n++)e["user_"+n].isBanker=t.data==(1==n?"60":80-5*(n-1))},this)},t.prototype.onClickMenu=function(e){switch(e.data){case 1:StageMgr.ins.addWindow(new Share(1));break;case 2:StageMgr.ins.addWindow(new Help);break;case 3:StageMgr.ins.addWindow(new Share(2));break;case 4:StageMgr.ins.addWindow(new DissolveRoom);break;case 5:StageMgr.ins.addTips(new Tips("您确定要离开房间吗"),2,function(){EventMgr.ins.sendMessage({cmd:NET_CMD.LEAVE_GAME,roleId:PlayerMgr.ins.roleId,roomId:PlayerMgr.ins.roomId})})}},t.prototype.showDice=function(e){var t=this,n=this.diceMc;n||(n=this.diceMc=new egret.MovieClip(new egret.MovieClipDataFactory(RES.getRes("dice_json"),RES.getRes("dice_png")).generateMovieClipData("dice")),n.x=508,n.y=305,this.g_dice.addChild(n));var r=2e3,i=egret.getTimer();n.gotoAndPlay("diceAnimation",1),SoundMgr.playMuisc("dice",void 0,void 0,.15),n.visible=!0,n.once(egret.Event.COMPLETE,function(a){var s=egret.getTimer()-i,o=t.g_dice;n.visible=!1;var c=new eui.Image("shaizi"+e[0]+"_png");c.x=517,c.y=364,o.addChild(c);var d=new eui.Image("shaizi"+e[1]+"_png");d.x=614,d.y=364,o.addChild(d),egret.setTimeout(function(){o.removeChild(c),o.removeChild(d),t.cardDesk.visible=!0},t,r-s)},this)},t.prototype.showInterActionFace=function(e){var t=this,n=parseInt(e[0]),r=parseInt(e[1]),i=parseInt(e[2]),a=new eui.Image("interaction_"+i+"_png");a.x=this["user_"+PlayerMgr.ins.getLocalSeatNo(n)].x-5,a.y=this["user_"+PlayerMgr.ins.getLocalSeatNo(n)].y-10,this.g_talk.addChild(a);var s=this["user_"+PlayerMgr.ins.getLocalSeatNo(r)].x,o=this["user_"+PlayerMgr.ins.getLocalSeatNo(r)].y,c=egret.Point.distance(new egret.Point(a.x,a.y),new egret.Point(s-5,o-10)),d=.9*c;egret.Tween.get(a).to({x:s-5,y:o-10},d,egret.Ease.circIn).call(function(){a.parent&&a.parent.removeChild(a);var e=1==i?"番茄":2==i?"吻":3==i?"鲜花":4==i?"红茶":5==i?"啤酒":"炸弹";DragonMgr.ins.playDragon(t.g_talk,"interactionFace",e,"newAnimation",{dx:s+55,dy:o+40})},this),egret.setTimeout(function(){SoundMgr.playMuisc("interaction_s"+i)},this,d-this.interActionTimeOut[i-1])},t}(eui.Component);__reflect(GameRoom.prototype,"GameRoom");var Help=function(e){function t(){var t=e.call(this)||this;return t.skinName=HelpSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dispose,this),this.rect_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.dispose,this);var t=new eui.VScrollBar;t.thumb=new eui.Group,this.scroll.verticalScrollBar=t,this.txt.text='一、牌型\n游戏中的麻将规则，按照四川一带的流行打法，尤其是以成都及周边地区较为盛行的规则打法。在麻将牌中去掉了“中，发，白”的字牌，去掉了“东，南，西，北”的风牌。只剩下筒，条，万，三色牌一共108张。麻将的打法按照当前流行的十三张打法。\n二、开局\n掷一次色子，按照点数大小确定庄家，大为庄；\n每局庄家为上一局第一个胡牌的玩家，如上一局有玩家一炮双响，则放炮玩家为本局庄家。\n三、 麻将规则\n成都麻将规定，做牌的时候，游戏玩家必需从筒，条，万的三色牌中任意打缺一门牌才能胡牌。\n1、血战到底\n必须缺门可胡，即胡牌时不能有三种花色的牌同时出现。同时，加入血战的功能。即一家胡牌以后停止,其余几家继续打牌,直到剩下最后一家没有胡牌的玩家或者摸完最后一张牌。\n2、刮风下雨\n在血战打法的基础上，加入刮风下雨的功能，也就是杠牌。刮风为明杠，下雨为暗杠。\n刮风（明杠）：玩家手上已经碰了三张一样的牌，当玩家自己又摸起了第四张一样的牌，这时，玩家也可以选择杠牌。这种杠牌可以收桌面上其它所有还未胡牌的玩家的筹码。\n下雨（暗杠）：玩家有四张一样的牌就可以拿出来进行下雨。这样的杠牌可以收桌面上其它所有还未胡牌的玩家的筹码。\n飘雨(明杠）：玩家手中有三张一样的牌，其它玩家打出了第四张一样的牌，玩家可以选择杠牌，这种叫做直杠，这种杠牌可以收桌面上其它所有还未胡牌的玩家的筹码。\n其中打出第四张牌的玩家被收筹码是另外两家的一倍。\n四、打牌规则\n1、打缺\n在四川麻将的做牌规则里面，筒、条、万三种花色，必须打缺其中的一门花色，用剩下的两门花色来做牌。\n2、碰牌\n当玩家手中有两张一样的牌，由其他玩家打出了第三张一样的牌时，玩家可以选择碰牌。\n3、杠牌\n杠牌分为明杠和暗杠两种。明杠是玩家手中有三张一样的牌，当其他玩家打出了第四张一样的牌时，玩家可以选择杠牌。或者玩家已经碰了三张一样的牌时，玩家自己又摸到了第四张一样的牌，就可以选择杠牌了。暗杠是当玩家自己摸到了四张一样的牌时，此时玩家可以选择从手中把牌拿出来杠牌。\n杠牌可随时进行，比如自己手上有三张一样的牌，别人打出第四张时，可先选择碰，待自己下叫或其他时候再杠牌。\n4、下叫\n玩家根据牌型的规则，做好牌以后，并差一张牌就可以胡牌时，此时，玩家的牌的状况就叫做下叫。\n5、胡牌\n当玩家的牌下叫以后，由其他玩家打出了一张牌，正好是玩家的叫牌，此时，玩家可以选择胡牌。或者由玩家自己摸到了需要的叫牌，也可以选择胡牌。玩家自己摸到的胡牌方式叫做自摸。\n6、流局\n流局是指当桌面上所有牌都被摸完后，若还有两个或两个以上的玩家没有糊牌，则此时游戏为流局。\n游戏流局后，会有查卫生和查叫两种处理方式。\n7、查卫生（查花猪）\n查卫生是指当玩家在进入流局后，若手上的牌还有3种花色的话，将会被其他已经打缺的玩家进行查卫生。在牌打完后，手上还有3种花色的牌的玩家俗称"花猪"，所以查卫生也叫做查花猪。是花猪的玩家需要赔4番（×16倍）给其余所有不是花猪的玩家（包括已经糊牌的）。\n若有两家或者三家为花猪，则每个花猪玩家都需要赔给不是花猪玩家4番金币。\n8、查叫\n在摸完最后一张牌后，如果有玩家还没有胡牌时，已下叫的一方对还没有下叫的一方进行查叫。\n查叫是指当玩家在进入流局后，若手上的牌还没有下叫，将会被已经下叫的玩家进行查叫。被查的玩家将按其他已下叫的玩家手上的牌型来赔番数。\n查叫方按照所做牌型番数的最大番数对被查叫方进行查叫。例如牌型：112233556677筒99万。就是按暗七对的牌型计算，而不是基本胡。\n9、补差价\n补价差是指进行查叫时，下叫小牌的玩家要补给下叫大牌的玩家相应的牌型差价。\n例如：流局后，A、B、C三个玩家都已下叫。\nA玩家下叫牌型为基本糊（×1），B玩家下叫牌型为清一色（×4），C玩家下叫牌型为清一色七对（×16）。\n那么，则A玩家补给B玩家（4-1）倍的差价，补给C玩家（16-1）倍的差价；B玩家也要补给C玩家（16-4）倍的差价。\n10、退税\n流局查叫时，未下叫者（包括花猪）将退回所有刮风下雨的所得。\n五、胡牌规则\n1、最后四张牌必糊\n当牌局的牌墩还剩下最后4张的时候，如果玩家的手牌已经下叫，而在最后4张牌中自摸到自己可以糊的牌，下叫的玩家必须选择胡牌。而不能跳过胡牌去进入后面的查叫过程。玩家没有选择的权利。\n2、抢杠\n当有玩家在碰牌以后，又再次杠此碰牌，而这张杠牌又正好是其他玩家胡牌的叫牌，其他玩家可以选择胡这张杠牌。以胡牌为优先。这种情况又叫做抢杠。\n3、当一家胡牌后，剩下三家杠、胡牌的记分与第一家无关，以此类推。\n4、如果玩家A胡一筒，玩家B、C、D依次是玩家A的下家，玩家B打了一筒，玩家A不胡，此时玩家C再一次（本圈内）打出一筒，玩家A不能胡牌。\n六、胡牌牌型及记分\n番数：番数是玩家在每盘牌局结束后的计算单位，每种牌型有不同的番数计算。\n底金：本桌牌局每番结算的固定金额。\n1、基本胡及番数（0番 底金×1）\n玩家的手牌为任意的两门牌，并且已经下叫胡牌，所胡牌的番数为1番就叫做基本胡。 牌型如：23445677万345789筒。\n2、对对胡即大对子（1番 底金×2）\n玩家的手牌除了一对将牌以外，剩下的牌都是三张一对的，一共四对，这样的牌型胡牌就叫做对对胡。牌型如：111333444万66677筒。\n3、七对即暗七对（2番 底金：×4）\n玩家胡牌的手牌全部都是两张一对的，没有碰过牌和杠过牌。这样的牌型叫做七对。牌型如：11334466万557799筒。\n4、清一色（2番 底金：×4）\n玩家胡牌的手牌全部都是一门花色，这样的牌型叫做清一色。牌型如：11223345678999万。\n5、幺九（2番 底金：×4）\n在玩家手上的牌当中，全部是用1的连牌或者9的连牌组成的牌叫做幺九。牌型如：111222333万78999筒。\n6、清对即清大对（3番 底金：×8）\n玩家手上的牌是清一色的对对胡，这样的牌型叫清对。牌型如：22244455577799万。\n7、将对即将大对（3番 底金：×8）\n玩家手上的牌是带二、五、八的对对胡，这样的牌型叫将对。牌型如：222555888万55588筒。\n8、清七对即清一色暗七对（4番 底金：×16）\n玩家手上的牌是清一色的七对，这样的牌型叫清七对。牌型如：11334466778899万。\n9、龙七对即四归一的暗七对（4番 底金：×16）\n玩家手中的牌为暗七对牌型，没有碰过牌杠过牌时，并且有四张牌是一摸一样的，这样的牌型叫做龙七对。牌型如：11222244万557788筒。\n10、清幺九（4番 底金：×16）\n玩家手上的牌时清一色的幺九，这样的牌叫清幺九。牌型如11123777888999万。\n11、清龙七对（5番 底金：×32）\n玩家手上的牌是清一色的龙七对，这样的牌型叫清龙七对。牌型如：11224444557799万。\n12、天胡（5翻 底金：×32）\n在打牌的过程中，庄家在第一次摸完牌后，就胡牌，这样的情况叫做天胡。\n13、地胡（5翻 底金：×32）\n在打牌的过程中，闲家在第一次摸完牌后，就下叫，并在第一轮摸牌后胡牌。这样的情 况叫做地胡。\n七、加番类型\n1、带根（每根+1番）\n在玩家胡牌的手牌当中，有四张牌是一摸一样的（已杠牌除外）这样的牌就叫做代根。牌型如：123333万45566799条。\n2、补杠刮风（每杠+1番）\n糊牌的玩家在游戏过程中，有以下情况：碰了三个一样的牌，摸到第四个相同的牌开杠的时候，叫做补杠刮风。\n3、直杠刮风（每杠+1番）\n糊牌的玩家在游戏过程中，有以下情况：手上有三个相同的牌，当别人打出第四个相同的牌的时候开杠，叫做直杠刮风。\n4、暗杠下雨（每杠+2番）\n糊牌的玩家在游戏过程中，有以下情况：手上摸到四个相同的牌而开杠时，叫做暗杠下雨。\n5、杠上花（+2或3番）：刮风杠开时为2番，下雨杠开时为3番\n玩家的手牌已经下叫，并且玩家在杠牌时，杠起一张牌正好是玩家自己所要的叫牌，这时玩家可以选择胡牌，这种情况叫做杠上花。\n6、杠上炮（＋1番）\n玩家在杠牌时，先杠一张牌，再打掉一张牌，而打出的这张牌正好是其它玩家胡牌所需要的叫牌时，这种情况叫做杠上炮。\n7、抢杠（＋1番）\n玩家抢杠时，在玩家原有糊牌牌型的基础上加一番。 '},t.prototype.dispose=function(){this.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.dispose,this),this.rect_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.dispose,this),e.prototype.dispose.call(this)},t}(EffectWindow);__reflect(Help.prototype,"Help");var Login=function(e){function t(){var t=e.call(this)||this;return t.skinName=LoginSkin,EventMgr.ins.once(""+SELF_EVT.READY,t.onCreateRoomSuccess,t),IframeManager.ins.sendUILoadFinish(),t}return __extends(t,e),t.prototype.onCreateRoomSuccess=function(){EventMgr.ins.addEventListener(""+NET_CMD.GET_ROOM_INFO,this.onJoinSuccess,this),EventMgr.ins.sendMessage({cmd:NET_CMD.GET_ROOM_INFO})},t.prototype.onJoinSuccess=function(e){if(e.data.room){EventMgr.ins.removeEventListener(""+NET_CMD.GET_ROOM_INFO,this.onJoinSuccess,this);var t=PlayerMgr.ins.userArr=e.data.room.seatId_seatData_Map,n=t[e.data.joinSeatId];PlayerMgr.ins.isOwner=n.player.roleId==e.data.room.creator,PlayerMgr.ins.roleId=n.player.roleId,PlayerMgr.ins.roomId=n.player.roomId,PlayerMgr.ins.currentRound=e.data.room.round,PlayerMgr.ins.totalRound=e.data.room.createData.totalRound,PlayerMgr.ins.isExchange3=e.data.room.createData.isExchange3,PlayerMgr.ins.headImg=n.player.headImgUrl,PlayerMgr.ins.score=n.totalScore,PlayerMgr.ins.seatNo=n.seatId,PlayerMgr.ins.gameIsStarted=e.data.room.gameStatus>2,PlayerMgr.ins.bankerSeatId=e.data.room.bankerSeatId,e.data.room.newstOperateCardSource&&(PlayerMgr.ins.lastPutSeatNo=e.data.room.newstOperateCardSource),e.data.room.newstOperateCard&&(PlayerMgr.ins.lastPutCard=e.data.room.newstOperateCard),null!=e.data.room.cardsPool&&(PlayerMgr.ins.resetGameCardNum=e.data.room.cardsPool.length),e.data.room.gameStatus&&(PlayerMgr.ins.currentGameStatus=e.data.room.gameStatus),PlayerMgr.ins.roomMode=e.data.room.createData.timeOrRound,PlayerMgr.ins.totalTime=e.data.room.createData.time,PlayerMgr.ins.balanceTime=~~(e.data.remainsTime/1e3);var r=egret.localStorage.getItem("xzmj_music");if(r){var i=JSON.parse(r);SoundMgr.musicSwitch=i[0],SoundMgr.soundSwitch=i[1]}StageMgr.ins.loadBase(new GameRoom)}else egret.error("登录失败，没有房间数据")},t}(eui.Component);__reflect(Login.prototype,"Login");var Menu=function(e){function t(){var t=e.call(this)||this;return t.skinName=MenuSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.rect_menu_1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuTap,this),this.rect_menu_2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuTap,this),this.rect_menu_3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuTap,this),this.rect_menu_4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuTap,this),this.rect_menu_5.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMenuTap,this),this.rect_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHide,this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.rect_menu_1.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onMenuTap,e),e.rect_menu_2.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onMenuTap,e),e.rect_menu_3.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onMenuTap,e),e.rect_menu_4.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onMenuTap,e),e.rect_menu_5.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onMenuTap,e),e.rect_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onHide,e)},this),this.onShow()},t.prototype.canDissolve=function(e){this.m4mask.alpha=e?1:.5,this.rect_menu_4.touchEnabled=e},t.prototype.canBack=function(e){this.m5mask.alpha=e?1:.5,this.rect_menu_5.touchEnabled=e},t.prototype.onMenuTap=function(e){var t;switch(e.currentTarget){case this.rect_menu_1:t=1;break;case this.rect_menu_2:t=2;break;case this.rect_menu_3:t=3;break;case this.rect_menu_4:t=4;break;case this.rect_menu_5:t=5}EventMgr.ins.onEvt(SELF_EVT.CLICK_MENU,t),this.onHide()},t.prototype.onShow=function(){this.canDissolve(PlayerMgr.ins.isOwner||PlayerMgr.ins.gameIsStarted),this.canBack(!PlayerMgr.ins.gameIsStarted),this.show.play(0)},t.prototype.onHide=function(){var e=this;egret.Tween.get(this.menu).set({alpha:1,y:95}).to({alpha:0,y:75},500,egret.Ease.circOut).call(function(){e.parent&&e.parent.removeChild(e)},this),egret.Tween.get(this.rect_touch).set({alpha:1}).to({alpha:0},500,egret.Ease.circOut)},t}(eui.Component);__reflect(Menu.prototype,"Menu");var Notificat=function(e){function t(t,n){void 0===n&&(n=3e3);var r=e.call(this)||this;return r.skinName=NotificationSkin,r.msg=t,r.timeOut=n,r}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.verticalCenter=-100,this.horizontalCenter=0,this.msg&&(this.txt_msg.text=this.msg),egret.Tween.get(this).set({alpha:0}).to({alpha:1},150).wait(this.timeOut).to({alpha:0},100).call(function(){e.parent&&e.parent.removeChild(e)},this)},t.prototype.setTextFlow=function(e){return e&&(this.txt_msg.textFlow=e),this},t}(eui.Component);__reflect(Notificat.prototype,"Notificat");var PGH=function(e){function t(){var t=e.call(this)||this;return t.skinName=PGHSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.bottom=0,this.g_PGHG.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupTap,this),this.g_gang.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelectedGang,this),EventMgr.ins.addEventListener(""+NET_CMD.HIDE_CHI_PENG_GANG,function(){e.init()},this)},t.prototype.onGroupTap=function(e){var t=e.target.icon;
if(null!=t){var n;switch(t){case"btn_hu_png":this.pghData.putCard||(this.pghData.putCard=this.pghData.touchCard),n=1;break;case"btn_gang_png":if(this.pghData.gangArr&&(this.pghData.gangList=this.pghData.gangArr.filter(function(e){return 2==e[0]}).map(function(e){return e[1]})),this.pghData.gangList&&this.pghData.gangList.length>1)return void this.showSelectCard();this.pghData.gangList&&(this.pghData.putCard=this.pghData.gangList[0]),n=2;break;case"btn_peng_png":n=3;break;case"btn_guo_png":n=4}this.sendToWebSocket(this.pghData.putCard,n)}},t.prototype.showSelectCard=function(){var e=this,t=this.pghData.gangList;t.forEach(function(t){e.g_gang.addChild(new CardPG(t,1,3))}),this.img_bg.width=2==t.length?423:601,this.g_PGHG.visible=!1,this.g_select_gang.visible=!0,this.visible=!0},t.prototype.onSelectedGang=function(e){var t=e.target.parent.parent.parent.serialNo;t&&this.sendToWebSocket(t,2)},t.prototype.sendToWebSocket=function(e,t){EventMgr.ins.sendMessage({cmd:NET_CMD.PENG_GANG,putSeatId:PlayerMgr.ins.lastPutSeatNo,typePGHG:t,card:e})},t.prototype.showBtn=function(e){this.initGroup(e),this.g_PGHG.visible=!0,this.g_select_gang.visible=!1,this.visible=!0,this.pghData=e},t.prototype.initGroup=function(e){this.hasHu=this.hasGang=this.hasPeng=this.hasGuo=!1,e.canHu&&(this.hasHu=!0),e.canGang&&(this.hasGang=!0),e.canPeng&&(this.hasPeng=!0),this.hasGuo=!0},t.prototype.init=function(){this.visible=!1},Object.defineProperty(t.prototype,"hasHu",{get:function(){return this._hasHu},set:function(e){this._hasHu=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasGang",{get:function(){return this._hasGang},set:function(e){this._hasGang=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPeng",{get:function(){return this._hasPeng},set:function(e){this._hasPeng=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasGuo",{get:function(){return this._hasGuo},set:function(e){this._hasGuo=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(PGH.prototype,"PGH");var Setting=function(e){function t(){var t=e.call(this)||this;return t.skinName=SettingSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRemoveStage,this),this.rect_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRemoveStage,this),this.ts_music.addEventListener(egret.Event.CHANGE,this.onMusicChanged,this),this.ts_sound.addEventListener(egret.Event.CHANGE,this.onSoundChanged,this),this.ts_music.selected=SoundMgr.musicSwitch,this.ts_sound.selected=SoundMgr.soundSwitch},t.prototype.onRemoveStage=function(){this.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRemoveStage,this),this.rect_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRemoveStage,this),this.ts_music.removeEventListener(egret.Event.CHANGE,this.onMusicChanged,this),this.ts_sound.removeEventListener(egret.Event.CHANGE,this.onSoundChanged,this),egret.localStorage.setItem("fhmj_music",JSON.stringify([SoundMgr.musicSwitch,SoundMgr.soundSwitch])),e.prototype.dispose.call(this)},t.prototype.onMusicChanged=function(e){SoundMgr.musicSwitch=e.target.selected,SoundMgr.musicSwitch?SoundMgr.playBgMuisc():SoundMgr.closeBgMuisc()},t.prototype.onSoundChanged=function(e){SoundMgr.soundSwitch=e.target.selected},t}(EffectWindow);__reflect(Setting.prototype,"Setting");var SettlementBig=function(e){function t(t){var n=e.call(this)||this;return n.skinName=SettlementBigSkin,n.dataArr=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initData(),this.btn_continue.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){IframeManager.ins.backToHall()},this),this.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){StageMgr.ins.addWindow(new Share(3))},this)},t.prototype.initData=function(){var e,t=[];for(var n in this.dataArr){var r=this.dataArr[n];r.seatId=n,t.push(r)}this.txt_title.text="血战麻将",this.txt_roomNum.text=""+PlayerMgr.ins.roomId;var i="",a=[];t.sort(function(e,t){return e.totalScore<t.totalScore?1:e.totalScore>t.totalScore?-1:0});var s=0;t.forEach(function(n,r){var o={},c=PlayerMgr.ins.getPlayerForSeatNo(n.seatId);o.nick=Utils.limitNick(c.player.nickname,7),o.score=n.totalScore,o.round=n.totalRound||PlayerMgr.ins.currentRound,o.win=n.win,o.lose=n.defeated,o.headUrl=c.player.headImgUrl,o.isWin=n.totalScore>0,o.rankIcon="medal_"+(o.isWin?0==r?++s:n.totalScore==t[r-1].totalScore?s:++s:3)+"_png",n.player.roleId==PlayerMgr.ins.roleId?e=n.totalScore:i+=Utils.limitNick(c.player.nickname)+"："+o.score+"\n",a.push(o)},this),this.list_data.dataProvider=new eui.ArrayCollection(a),this.list_data.itemRenderer=Item_SettlementSmall,IframeManager.ins.initWxShare("我在血战麻将中"+(e>=0?"赢了":"输了")+Math.abs(e)+"分，快来和我一起搓麻将吧！",i,PlayerMgr.ins.headImg)},t}(EffectWindow);__reflect(SettlementBig.prototype,"SettlementBig");var Item_SettlementBig=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data;this.currentData!=e&&(this.currentData=e,e.score>=0?(this.txt_score.text="+"+e.score,this.txt_score.textColor=12708447):(this.txt_score.text=e.score,this.txt_score.textColor=16746118))},t}(eui.ItemRenderer);__reflect(Item_SettlementBig.prototype,"Item_SettlementBig");var SettlementSmall=function(e){function t(t){var n=e.call(this)||this;return n.data=t,n.skinName=SettlementSmallSkin,console.log("jiesuan "),n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initData(),this.btn_continue.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendReady,this)},t.prototype.sendReady=function(){PlayerMgr.ins.totalSettlement?(StageMgr.ins.addWindow(new SettlementBig(PlayerMgr.ins.totalSettlement)),this.visible=!1):EventMgr.ins.sendMessage({cmd:NET_CMD.READY,roleId:PlayerMgr.ins.roleId,isReady:!0})},t.prototype.initData=function(){var e=this.data.seatId_countData,t=[];for(var n in e){var r=e[n],i={};i.headUrl=r.player.headImgUrl,i.score=r.huData.score,i.cards=r.handCards.sort(Utils.sortCard),i.huCard=r.huData.huCard,i.pengGang=r.pGDate,i.scoreList=r.huData.huType_fan||{},i.huCard&&delete r.handCards[""+r.handCards.indexOf(i.huCard)],i.isWin=r.huData.score>0,r.totalScore&&EventMgr.ins.onEvt(SELF_EVT.UPDATE_SCORE,{seat:n,score:r.totalScore}),t.push(i)}this.list_data.dataProvider=new eui.ArrayCollection(t),this.list_data.itemRenderer=Item_SettlementSmall},t.prototype.dispose=function(){this.btn_continue.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.sendReady,this),e.prototype.dispose.call(this)},t}(EffectWindow);__reflect(SettlementSmall.prototype,"SettlementSmall");var Item_SettlementSmall=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){var e=this,t=this.data;if(this.currentData!=t){this.currentData=t,t.score>=0?(this.txt_score.text="+"+t.score,this.txt_score.textColor=12708447):(this.txt_score.text=t.score,this.txt_score.textColor=16746118);var n=t.pengGang;n&&n.forEach(function(t){e.g_card1.addChild(new CardPG(t.card,1,t.type))},this);var r=t.cards;r&&r.forEach(function(t){var n=new Card(t,1,3);e.g_card2.addChild(n)},this);var i=t.huCard;if(i){var a=new Card(i,1,3);this.g_card3.addChild(a)}this.txt_type&&(this.txt_type.text="");var s=t.scoreList;if(s&&Object.keys(s).forEach(function(t){e.txt_type.text+=CARD_TYPE[t]+" +"+s[t]+"番    "},this),this.txt_type&&this.txt_type.width>548){this.img_arrLeft.visible=!0,this.img_arrRight.visible=!0;var o=new eui.HScrollBar;o.thumb=new eui.Group,this.scr_type.horizontalScrollBar=o}}},t}(eui.ItemRenderer);__reflect(Item_SettlementSmall.prototype,"Item_SettlementSmall");var CARD_TYPE;!function(e){e[e["平胡"]=1]="平胡",e[e["七对"]=2]="七对",e[e["门清"]=3]="门清",e[e["碰碰胡"]=4]="碰碰胡",e[e["断幺九"]=5]="断幺九",e[e["清一色"]=6]="清一色",e[e["金钩钓"]=7]="金钩钓",e[e["带幺九"]=8]="带幺九",e[e["清碰"]=10]="清碰",e[e["将对"]=11]="将对",e[e["清七对"]=12]="清七对",e[e["清金钩钓"]=13]="清金钩钓",e[e["将金钩钓"]=14]="将金钩钓",e[e["龙七对"]=15]="龙七对",e[e["清幺九"]=16]="清幺九",e[e["清龙七对"]=17]="清龙七对",e[e["十八罗汉"]=18]="十八罗汉",e[e["清十八罗汉"]=19]="清十八罗汉",e[e["天胡"]=20]="天胡",e[e["地胡"]=21]="地胡",e[e["杠上花"]=22]="杠上花",e[e["杠上炮"]=23]="杠上炮",e[e["抢杠胡"]=24]="抢杠胡",e[e["自摸"]=25]="自摸",e[e["根和杠"]=26]="根和杠",e[e["海底"]=27]="海底"}(CARD_TYPE||(CARD_TYPE={}));var Share=function(e){function t(t){var n=e.call(this)||this;return n.skinName=ShareSkin,n.shareType=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this,t=function(){e.parent&&e.img_arrow&&egret.Tween.get(e.img_arrow).set({x:1056}).to({x:1112},600).call(t)};t();var n=this.img_share;n.source="share_"+this.shareType+"_png",n&&TweenUtils.showBackOut(n,300),this.rect_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDestroy,this),EventMgr.ins.addEventListener(""+SELF_EVT.SHARE_FINISH,this.onDestroy,this)},t.prototype.onDestroy=function(){this.rect_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDestroy,this),EventMgr.ins.removeEventListener(""+SELF_EVT.SHARE_FINISH,this.onDestroy,this),this.parent&&this.parent.removeChild(this)},t}(eui.Component);__reflect(Share.prototype,"Share");var Talk=function(e){function t(t,n){var r=e.call(this)||this;return r.localSeatNo_point={1:[124,416],2:[838,218],3:[320,72],4:[124,218]},r.skinName=TalkSkin,r.localSeatNo=t,r.msg=n,r}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;this.currentState="seat"+this.localSeatNo,this.txt_content.text=this.msg,this.x=this.localSeatNo_point[""+this.localSeatNo][0],this.y=this.localSeatNo_point[""+this.localSeatNo][1],TweenUtils.showBackOut(this,300,function(){egret.Tween.get(e).wait(2e3).to({alpha:0,scaleX:0,scaleY:0,x:e.x+e.width/2,y:e.y+e.height/2},200,egret.Ease.backIn).call(function(){e.parent&&e.parent.removeChild(e)},e)})},t}(eui.Component);__reflect(Talk.prototype,"Talk");var Tips=function(e){function t(t,n){var r=e.call(this)||this;return r.skinName=TipsSkin,r.msgString=t,n&&egret.setTimeout(function(){r.onDestory()},r,n),r}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.txt_msg.text=this.msgString,this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickOk,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickCancel,this)},t.prototype.onClickOk=function(){this._okFun&&this._okFun.call(this),this.onDestory()},t.prototype.onClickCancel=function(){this._cancelFun&&this._cancelFun.call(this),this.onDestory()},Object.defineProperty(t.prototype,"okFun",{set:function(e){this._okFun=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cancelFun",{set:function(e){this._cancelFun=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{set:function(e){switch(e){case 0:this.btn_ok.visible=!1,this.btn_cancel.visible=!1;break;case 1:this.btn_cancel.visible=!1,this.btn_ok.horizontalCenter=0;break;case 2:this.btn_ok.horizontalCenter=150,this.btn_cancel.horizontalCenter=-150}},enumerable:!0,configurable:!0}),t.prototype.onDestory=function(){this.btn_ok.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickOk,this),this.btn_cancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickCancel,this),e.prototype.dispose.call(this)},t}(EffectWindow);__reflect(Tips.prototype,"Tips");var TipsHu=function(e){function t(t){var n=e.call(this)||this;return n.skinName=TipsHuSkin,n.huData=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.list_card.itemRenderer=Item_TipsHu,this.list_card.dataProvider=new eui.ArrayCollection(this.huData),this.currentState="c"+this.huData.length,this.horizontalCenter=0,this.bottom=130,EventMgr.ins.once(""+SELF_EVT.SELECTED_CARD,function(){t.parent&&t.parent.removeChild(t)},this)},t}(eui.Component);__reflect(TipsHu.prototype,"TipsHu");var Item_TipsHu=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.dataChanged=function(){var e=this.data;this.currentData!=e&&(this.currentData=e,this.c_card.setCard(e.card),this.txt_num.text=e.num+"张",e.num||(this.c_card.isGray=!0))},t}(eui.ItemRenderer);__reflect(Item_TipsHu.prototype,"Item_TipsHu");var User=function(e){function t(){var t=e.call(this)||this;return t._lack="",t.skinName=UserSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){var e=this;EventMgr.ins.addEventListener(""+SELF_EVT.UPDATE_SCORE,function(t){t.data.seat==e.seat&&(e.txt_score.text=""+t.data.score)},this),EventMgr.ins.addEventListener(""+SELF_EVT.UPDATE_LACK,function(t){t.data.seatId==e.seat&&(e.lack=t.data.lack?"show_lack_"+t.data.lack+"_png":"")},this)},t.prototype.initUser=function(e){var t=this;RES.getResByUrl(e.headUrl,function(e){t.img_head.texture=e,t.img_headC.texture=e},this,RES.ResourceItem.TYPE_IMAGE),this.txt_nick.text=Utils.limitNick(e.nick),this.txt_nickC.text=Utils.limitNick(e.nick),this.txt_score.text=""+e.score,this.visible=!0,this._seat=e.seat,this.isBanker=e.isBanker,this.lack=e.lack?"show_lack_"+e.lack+"_png":""},t.prototype.removeUser=function(){this.img_head.texture=null,this.img_headC.texture=null,this.visible=!1},t.prototype.setPlayerStatus=function(e){this.rect_offLine.visible=!e,this.txt_offLine.visible=!e},t.prototype.showVoice=function(){var e=this;this.img_voice.visible=!0;var t=0;this.intervalVoice=egret.setInterval(function(){e.img_voice.source="voice_show"+t++ +"_png",t>=3&&(t=0)},this,500)},t.prototype.hideVoice=function(){this.img_voice.visible=!1,egret.clearInterval(this.intervalVoice)},Object.defineProperty(t.prototype,"isBanker",{get:function(){return this._isBanker},set:function(e){this._isBanker=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seat",{get:function(){return this._seat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lack",{get:function(){return this._lack},set:function(e){this._lack=e},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(User.prototype,"User");var UserInfo=function(e){function t(t){var n=e.call(this)||this;return n.skinName=UserInfoSkin,n.player=t,n}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=this.player.player;this.player_nick=Utils.limitNick(t.nickname,12),this.player_id=t.roleId,this.player_ip=t.ip,this.player_head=t.headImgUrl,this.g_face.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchFace,this),this.rect_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDestroy,this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDestroy,this)},t.prototype.onTouchFace=function(e){var t=e.target.source;if(t&&PlayerMgr.ins.seatNo!=this.player.seatId){var n=t.split("_")[2],r="i1n2t3e4r5a6c7t8i9o0n"+PlayerMgr.ins.seatNo+"_"+this.player.seatId+"_"+n;EventMgr.ins.sendMessage({cmd:NET_CMD.CHAT_MSG,roleId:PlayerMgr.ins.roleId,msg:PlayerMgr.ins.seatNo+"|"+r}),this.onDestroy()}},t.prototype.onDestroy=function(){this.g_face.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchFace,this),this.rect_touch.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDestroy,this),this.btn_close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDestroy,this),e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"player_nick",{get:function(){return this._player_nick},set:function(e){this._player_nick=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"player_head",{get:function(){return this._player_head},set:function(e){this._player_head=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"player_ip",{get:function(){return this._player_ip},set:function(e){this._player_ip=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"player_id",{get:function(){return this._player_id},set:function(e){this._player_id=e},enumerable:!0,configurable:!0}),t}(EffectWindow);__reflect(UserInfo.prototype,"UserInfo");var Voice=function(e){function t(){var t=e.call(this)||this;return t.skinName=VoiceSkin,t}return __extends(t,e),t.prototype.childrenCreated=function(){this.horizontalCenter=0,this.verticalCenter=0,e.prototype.childrenCreated.call(this),EventMgr.ins.addEventListener(""+SELF_EVT.STOP_VOICE,this.onStopVoice,this),this.show.addEventListener(egret.Event.COMPLETE,this.showVoice,this),this.showVoice()},t.prototype.showVoice=function(){this.show.play(0)},t.prototype.onStopVoice=function(t){this.onRemove();var n=t.data.enable,r=t.data.msg;n?e.prototype.dispose.call(this):(TweenUtils.showBackIn(this.box,280),this.showLabel(r))},t.prototype.onRemove=function(){EventMgr.ins.removeEventListener(""+SELF_EVT.STOP_VOICE,this.onStopVoice,this),this.show.removeEventListener(egret.Event.COMPLETE,this.showVoice,this),this.show.stop()},t.prototype.showLabel=function(e){var t=this;this.g_tip.getChildByName("msg").text=e,egret.Tween.get(this.g_tip).set({visible:!0,y:154,alpha:0}).to({alpha:1,y:144},400,egret.Ease.cubicOut).wait(650).to({y:134,alpha:0},300).call(function(){t.dispose()},this)},t}(EffectWindow);__reflect(Voice.prototype,"Voice");var TweenUtils=function(){function e(){}return e.showBackOut=function(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),e){var i=e.width/4,a=e.height/4;e.x=e.x+i,e.y=e.y+a;var s=egret.Tween.get(e).set({alpha:0,scaleX:.5,scaleY:.5}).to({alpha:1,scaleX:1,scaleY:1,x:e.x-i,y:e.y-a},t,egret.Ease.backOut);n&&s.call(n,r)}},e.showSignet=function(e,t){var n=e.x,r=e.y;egret.Tween.get(e).set({alpha:0,x:n-e.width/2*(t-1),y:r-e.height/2*(t-1),scaleX:t,scaleY:t}).to({alpha:1,x:n,y:r,scaleX:1,scaleY:1},150),egret.setTimeout},e.showBackIn=function(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=null),!e)return void(n&&n());var i=egret.Tween.get(e).to({scaleX:0,scaleY:0,x:e.x+e.width/2,y:e.y+e.height/2},t,egret.Ease.backIn);n&&i.call(n,r)},e}();__reflect(TweenUtils.prototype,"TweenUtils");var Utils=function(){function e(){}return e.limitNick=function(e,t){if(void 0===t&&(t=10),e.replace(/[^\x00-\xff]/g,"aa").length>t){for(var n=0,r=e.length,i=0;r>i&&(0!=(65280&e.charCodeAt(i))&&n++,n++,!(n>t));i++);e=e.slice(0,i)+"..."}return e},e.sortCard=function(e,t){return e>t?1:t>e?-1:0},e.getWildCard=function(t){return e.wildCardArr[0].some(function(e){return t==e},this)?e.wildCardArr[0]:e.wildCardArr[1].some(function(e){return t==e},this)?e.wildCardArr[1]:[t]},e.formatTime=function(e){var t="00",n="00";return e>=60&&(t=""+~~(e/60),parseInt(t)<10?t="0"+t:""+t,e%=60),0>e&&(e=0),n=""+e,parseInt(n)<10?n="0"+n:""+n,t+":"+n},e.randomFrom=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},e.wildCardArr=[[95,100,105,110],[115,120,125,130]],e}();__reflect(Utils.prototype,"Utils");